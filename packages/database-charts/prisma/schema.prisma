// Prisma schema for charts-specific database

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client-charts"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL_CHARTS")
}

// 数据集合/项目
model Collection {
  id             String   @id @default(uuid())
  userId         String
  name           String
  description    String?
  icon           String?
  dateDimensions String   @default("day") // "year" | "month" | "day" | "time"

  records        Record[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([userId])
  @@map("collections")
}

// 数据记录
model Record {
  id           String     @id @default(uuid())
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  
  recordDate   DateTime
  data         String
  
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([collectionId])
  @@index([recordDate])
  @@map("records")
}

// AI 分析
model AIAnalysis {
  id            String   @id @default(uuid())
  userId        String
  
  collectionIds String                              // JSON array of collection IDs
  
  query         String
  response      String
  context       String?
  analysisType  String?
  model         String
  
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([collectionIds])
  @@map("ai_analysis")
}
